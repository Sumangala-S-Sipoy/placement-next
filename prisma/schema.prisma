
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// NextAuth.js Models
model Account {
  id                String  @id @default(cuid())
  userId            String  @map("user_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique @map("session_token")
  userId       String   @map("user_id")
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime? @map("email_verified")
  image         String?
  password      String?
  role          UserRole  @default(STUDENT)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  accounts Account[]
  sessions Session[]
  profile  Profile?

  @@map("users")
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@unique([identifier, token])
  @@map("verificationtokens")
}

// Custom Email Verification
model EmailVerificationToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime
  used    Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")

  @@map("email_verification_tokens")
}

// App-specific Models
model Profile {
  id        String   @id @default(cuid())
  userId    String   @unique @map("user_id")
  
  // Profile Completion Status
  isComplete Boolean @default(false) @map("is_complete")
  completionStep Int @default(1) @map("completion_step") // 1-7 for multi-step form
  
  // 1. Personal Information
  firstName String? @map("first_name")
  middleName String? @map("middle_name") 
  lastName  String? @map("last_name")
  dateOfBirth DateTime? @map("date_of_birth")
  gender    Gender?
  bloodGroup BloodGroup? @map("blood_group")
  stateOfDomicile String? @map("state_of_domicile")
  nationality String? @default("INDIAN")
  casteCategory CasteCategory? @map("caste_category")
  profilePhoto String? @map("profile_photo") // URL to uploaded photo
  
  // 2. Contact & Parent/Guardian Details - Student Contact
  email     String? // From User model but stored here for completeness
  callingMobile String? @map("calling_mobile")
  whatsappMobile String? @map("whatsapp_mobile")
  alternativeMobile String? @map("alternative_mobile")
  
  // Parent/Guardian Details
  fatherName    String? @map("father_name")
  fatherDeceased Boolean @default(false) @map("father_deceased")
  fatherMobile  String? @map("father_mobile")
  fatherEmail   String? @map("father_email")
  fatherOccupation String? @map("father_occupation")
  motherName    String? @map("mother_name")
  motherDeceased Boolean @default(false) @map("mother_deceased")
  motherMobile  String? @map("mother_mobile")
  motherEmail   String? @map("mother_email")
  motherOccupation String? @map("mother_occupation")
  
  // 3. Address Information
  currentAddress String? @map("current_address")
  permanentAddress String? @map("permanent_address")
  sameAsCurrent Boolean @default(false) @map("same_as_current")
  country String? @default("INDIA")
  
  // 4. Academic Details - 10th Standard
  tenthSchoolName String? @map("tenth_school_name")
  tenthAreaDistrictCity String? @map("tenth_area_district_city")
  tenthPincode String? @map("tenth_pincode")
  tenthState String? @map("tenth_state")
  tenthBoard Board? @map("tenth_board")
  tenthPassingYear Int? @map("tenth_passing_year")
  tenthPassingMonth Int? @map("tenth_passing_month")
  tenthMarksType MarksType? @map("tenth_marks_type")
  tenthPercentage Float? @map("tenth_percentage")
  tenthSubjects Int? @map("tenth_subjects")
  tenthTotalMarks Int? @map("tenth_total_marks")
  tenthMarksOutOf1000 Int? @map("tenth_marks_out_of_1000")
  tenthMarksCard String? @map("tenth_marks_card")
  
  // 12th Standard (if chosen)
  hasCompletedTwelfth Boolean @default(false) @map("has_completed_twelfth")
  twelfthSchoolName String? @map("twelfth_school_name")
  twelfthAreaDistrictCity String? @map("twelfth_area_district_city")
  twelfthPincode String? @map("twelfth_pincode")
  twelfthState String? @map("twelfth_state")
  twelfthBoard Board? @map("twelfth_board")
  twelfthPassingYear Int? @map("twelfth_passing_year")
  twelfthPassingMonth Int? @map("twelfth_passing_month")
  twelfthMarksType MarksType? @map("twelfth_marks_type")
  twelfthPercentage Float? @map("twelfth_percentage")
  twelfthSubjects Int? @map("twelfth_subjects")
  twelfthTotalMarks Int? @map("twelfth_total_marks")
  twelfthMarksOutOf1000 Int? @map("twelfth_marks_out_of_1000")
  twelfthMarksCard String? @map("twelfth_marks_card")
  
  // Diploma (if chosen)
  hasCompletedDiploma Boolean @default(false) @map("has_completed_diploma")
  diplomaCollegeName String? @map("diploma_college_name")
  diplomaAreaLocation String? @map("diploma_area_location")
  diplomaCertificate String? @map("diploma_certificate")
  diplomaSemesterSgpa Json? @map("diploma_semester_sgpa") // Array of SGPA for 6 semesters
  diplomaYearMarks Json? @map("diploma_year_marks") // Year-wise marks
  diplomaPercentage Float? @map("diploma_percentage")
  
  // 5. Engineering Details (SDMCET students only)
  collegeName String? @default("SDMCET") @map("college_name")
  collegeDistrict String? @default("DHARWAD") @map("college_district")
  collegePincode String? @default("580002") @map("college_pincode")
  branch EngineeringBranch? 
  entryType EntryType? @map("entry_type")
  seatCategory SeatCategory? @map("seat_category")
  usn       String? @unique // University Seat Number
  libraryId String? @map("library_id")
  residencyStatus ResidencyStatus? @map("residency_status")
  
  // Hostel Details (if Hostelite)
  hostelName String? @map("hostel_name")
  roomNumber String? @map("room_number")
  floorNumber String? @map("floor_number")
  
  // Local Details (if Localite)
  localCity String? @map("local_city")
  transportMode TransportMode? @map("transport_mode")
  busRoute String? @map("bus_route")
  
  // 6. Engineering Academic Records
  semesterRecords Json? @map("semester_records") // Array of semester data
  semesterMarksCards Json? @map("semester_marks_cards") // Array of uploaded cards
  failedSubjects Json? @map("failed_subjects") // Per semester failed subjects
  clearedAfterFailure Json? @map("cleared_after_failure") // Proof uploads
  
  // 7. Final KYC Details
  finalCgpa Float? @map("final_cgpa")
  activeBacklogs Boolean @default(false) @map("active_backlogs")
  backlogSubjects Json? @map("backlog_subjects") // Subject info if backlogs exist
  branchMentorName String? @map("branch_mentor_name")
  
  // Social Links (expanded)
  linkedin      String?
  github        String?
  leetcode      String?
  portfolio     String?
  codechef      String?
  codeforces    String?
  hackerrank    String?
  
  // Document Uploads
  resume        String? // Professional resume upload
  
  // Existing fields (keeping for compatibility)
  phone     String? // Deprecated - use callingMobile
  alternatePhone String? @map("alternate_phone") // Deprecated - use alternativeMobile
  department    String? // Deprecated - use branch
  course        String? // Keep for course type
  specialization String?
  semester      Int?
  year          Int?
  cgpa          Float?
  percentage    Float?
  
  // Address fields (expanded)
  currentCity    String? @map("current_city")
  currentState   String? @map("current_state")
  currentPincode String? @map("current_pincode")
  permanentCity    String? @map("permanent_city")
  permanentState   String? @map("permanent_state")
  permanentPincode String? @map("permanent_pincode")
  
  // Legacy parent fields (keeping for compatibility)
  guardianName  String? @map("guardian_name")
  guardianPhone String? @map("guardian_phone")
  guardianRelation String? @map("guardian_relation")
  
  // Professional Information
  skills        String[] @default([])
  certifications String[] @default([])
  projects      Json?    // Array of project objects
  internships   Json?    // Array of internship objects
  achievements  String[] @default([])
  hobbies       String[] @default([])
  languages     String[] @default([])
  
  // Placement Preferences
  expectedSalary Float? @map("expected_salary")
  preferredLocations String[] @default([]) @map("preferred_locations")
  jobType       JobType? @map("job_type")
  workMode      WorkMode? @map("work_mode")
  
  // KYC and Verification
  kycStatus     KYCStatus @default(PENDING) @map("kyc_status")
  verifiedBy    String? @map("verified_by") // Admin ID who verified
  verifiedAt    DateTime? @map("verified_at")
  remarks       String?
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("profiles")
}

enum UserRole {
  STUDENT
  RECRUITER
  ADMIN
}

enum Gender {
  MALE
  FEMALE
}

enum BloodGroup {
  A_POSITIVE
  A_NEGATIVE
  B_POSITIVE
  B_NEGATIVE
  AB_POSITIVE
  AB_NEGATIVE
  O_POSITIVE
  O_NEGATIVE
}

enum CasteCategory {
  GEN
  OBC
  SC
  ST
}

enum Board {
  STATE
  CBSE
  ICSE
}

enum MarksType {
  PERCENTAGE
  SUBJECTS_TOTAL
  OUT_OF_1000
}

enum EngineeringBranch {
  CSE
  ISE
  ECE
  EEE
  ME
  CE
  AIML
  DS
}

enum EntryType {
  REGULAR
  LATERAL
}

enum SeatCategory {
  KCET
  MANAGEMENT
  COMEDK
}

enum ResidencyStatus {
  HOSTELITE
  LOCALITE
}

enum TransportMode {
  COLLEGE_BUS
  PRIVATE_TRANSPORT
  PUBLIC_TRANSPORT
  WALKING
}

enum JobType {
  FULL_TIME
  PART_TIME
  INTERNSHIP
  CONTRACT
  FREELANCE
}

enum WorkMode {
  OFFICE
  REMOTE
  HYBRID
  FLEXIBLE
}

enum KYCStatus {
  PENDING
  UNDER_REVIEW
  VERIFIED
  REJECTED
  INCOMPLETE
}
